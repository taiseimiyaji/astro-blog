<!DOCTYPE html><html lang="ja"><head><title>TypeScriptのジェネリクス</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta name="description" content="
## はじめに

今回はTypeScriptのジェネリクスについてです。JavaScriptがある程度かければTypeScriptでつまづく箇所は結構少ないとは思いますが、つまづいたのがジェネリクスという概念でした。  
今回はジェネリク"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZBD90YGZ4N"></script><style>html{background-color:#23272f;font-size:16px;color:#f6f7f9}.header{color:#f6f7f9;justify-content:space-around;border-bottom:.5px solid}.header-link{display:flex;justify-content:space-around;font-size:1.5rem;padding:.5rem;border-color:#f6f7f9;margin:0 auto;max-width:70rem;width:94vw}.header-link div{color:#f6f7f9}.header .title{border-bottom:.5px solid;text-align:center;font-weight:700;padding:2rem;font-size:2.5rem}.card{box-sizing:border-box;background-color:#23272f;border:1px solid #F6F7F9;border-radius:1rem;display:flex;flex-direction:column;padding:2rem;gap:1rem;color:#f6f7f9}.card .title{font-size:large;overflow:inherit}.card-list{gap:1rem;flex-direction:column;display:flex}code{font-size:1rem}:root{--accent: 124, 58, 237;--accent-gradient: linear-gradient(45deg, rgb(var(--accent)), #da62c4 30%, white 60%)}html{font-family:system-ui,sans-serif}code{font-family:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace}.content{padding:2rem 0;margin:0 auto;max-width:70rem;width:94vw}.content .post{overflow-wrap:normal;overflow:hidden}a{color:#f6f7f9;text-decoration:none}img{width:100%}.footer{border-top:1px solid #F6F7F9;padding:1rem;align-items:center;display:flex;max-height:2rem}.footer .copyright{order:1}.footer .icons{margin-left:auto;order:2;width:2rem;height:2rem}
html{background-color:#23272f;font-size:16px;color:#f6f7f9}.header{color:#f6f7f9;justify-content:space-around;border-bottom:.5px solid}.header-link{display:flex;justify-content:space-around;font-size:1.5rem;padding:.5rem;border-color:#f6f7f9;margin:0 auto;max-width:70rem;width:94vw}.header-link div{color:#f6f7f9}.header .title{border-bottom:.5px solid;text-align:center;font-weight:700;padding:2rem;font-size:2.5rem}.footer{border-top:1px solid #F6F7F9;padding:1rem;align-items:center;display:flex;max-height:2rem}.footer .copyright{order:1}.footer .icons{margin-left:auto;order:2;width:2rem;height:2rem}.card{box-sizing:border-box;background-color:#23272f;border:1px solid #F6F7F9;border-radius:1rem;display:flex;flex-direction:column;padding:2rem;gap:1rem;color:#f6f7f9}.card .title{font-size:large;overflow:inherit}.card-list{gap:1rem;flex-direction:column;display:flex}.content a{text-decoration:underline}.content table{width:100%;border-collapse:collapse;margin:2rem 0}.content table th,.content table td{border:1px solid #F6F7F9;padding:.5rem;text-align:left}.content table th{background-color:#f6f7f933;color:#f6f7f9;font-weight:700}.content table tr:nth-child(odd){background-color:#f6f7f91a}.content table tr:nth-child(2n){background-color:#f6f7f90d}.content blockquote{padding:1rem;margin:1rem 0;border-left:4px solid #F6F7F9;background-color:#f6f7f91a;color:#f6f7f9;font-style:italic;overflow-wrap:break-word}.content blockquote p{margin:0}.content h2{color:#f6f7f9;margin:2rem 0 1rem;font-size:1.5rem;font-weight:700;border-bottom:2px solid #F6F7F9;padding-bottom:.5rem}
</style><script type="module">window.dataLayer=window.dataLayer||[];function a(){dataLayer.push(arguments)}a("js",new Date);a("config","G-ZBD90YGZ4N");
</script></head><!-- Google tag (gtag.js) --><body><main><div class="header"><div class="title"><a href="/">Lyricrime.com</a></div><div class="header-link"><a href="/"><div> Blog</div></a><a href="/activity"><div>Activity</div></a><a href="/profile"><div>Profile</div></a></div></div><div class="content"><div class="date">2023/03/12</div><h1>TypeScriptのジェネリクス</h1><div class="post"><h2 id="はじめに">はじめに</h2>
<p>今回はTypeScriptのジェネリクスについてです。JavaScriptがある程度かければTypeScriptでつまづく箇所は結構少ないとは思いますが、つまづいたのがジェネリクスという概念でした。<br>
今回はジェネリクスの仕組みと何を解決できるのかについて調査してみます。</p>
<h2 id="ジェネリクスとは">ジェネリクスとは</h2>
<p>型の安全性とコードの共通化を両立するための仕組み</p>
<p>抽象的な型引数を使用して、実際に利用されるまで型が確定しない<code>クラス</code>、<code>関数</code>、<code>インターフェース</code>を実現するために使われる。</p>
<p>参考サイトの例をみてみます。</p>
<p>中身のロジックが同じで引数の型が異なる関数が以下のように三つあります。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">chooseRandomlyString</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">v1</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8">, </span><span style="color: #FFAB70">v2</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8">)</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> Math.</span><span style="color: #B392F0">random</span><span style="color: #E1E4E8">() </span><span style="color: #F97583">&#x3C;=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">0.5</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">?</span><span style="color: #E1E4E8"> v1 </span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> v2;</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">chooseRandomlyNumber</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">v1</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">number</span><span style="color: #E1E4E8">, </span><span style="color: #FFAB70">v2</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">number</span><span style="color: #E1E4E8">)</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">number</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> Math.</span><span style="color: #B392F0">random</span><span style="color: #E1E4E8">() </span><span style="color: #F97583">&#x3C;=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">0.5</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">?</span><span style="color: #E1E4E8"> v1 </span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> v2;</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">chooseRandomlyURL</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">v1</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">URL</span><span style="color: #E1E4E8">, </span><span style="color: #FFAB70">v2</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">URL</span><span style="color: #E1E4E8">)</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">URL</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> Math.</span><span style="color: #B392F0">random</span><span style="color: #E1E4E8">() </span><span style="color: #F97583">&#x3C;=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">0.5</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">?</span><span style="color: #E1E4E8"> v1 </span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> v2;</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre>
<p>これらを共通化するにはどうすればいいでしょうか。<br>
解決策の1つは<code>any</code>型を使用して型チェックを放棄することですがせっかくTypeScriptを使う以上避けたいです。</p>
<p>ここで登場するのがジェネリクスで、下記のように書けます。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">chooseRandomly</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">>(</span><span style="color: #FFAB70">v1</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">, </span><span style="color: #FFAB70">v2</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">)</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> Math.</span><span style="color: #B392F0">random</span><span style="color: #E1E4E8">() </span><span style="color: #F97583">&#x3C;=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">0.5</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">?</span><span style="color: #E1E4E8"> v1 </span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> v2;</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"><span style="color: #B392F0">chooseRandomly</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8">>(</span><span style="color: #9ECBFF">"勝ち"</span><span style="color: #E1E4E8">, </span><span style="color: #9ECBFF">"負け"</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #B392F0">chooseRandomly</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #79B8FF">number</span><span style="color: #E1E4E8">>(</span><span style="color: #79B8FF">1</span><span style="color: #E1E4E8">, </span><span style="color: #79B8FF">2</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #B392F0">chooseRandomly</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">URL</span><span style="color: #E1E4E8">>(urlA, urlB);</span></span></code></pre>
<p>ここで、<code>T</code>には任意の型変数名が入ります。つまり、なんでも構わない名前です。慣習的に<code>Type</code>の<code>T</code>が使用されます。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">chooseRandomly</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">>(</span><span style="color: #FFAB70">v1</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">, </span><span style="color: #FFAB70">v2</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">)</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> Math.</span><span style="color: #B392F0">random</span><span style="color: #E1E4E8">() </span><span style="color: #F97583">&#x3C;=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">0.5</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">?</span><span style="color: #E1E4E8"> v1 </span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> v2;</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"><span style="color: #F97583">let</span><span style="color: #E1E4E8"> str </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">chooseRandomly</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8">>(</span><span style="color: #79B8FF">0</span><span style="color: #E1E4E8">, </span><span style="color: #79B8FF">1</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #6A737D">// エラー</span></span>
<span class="line"><span style="color: #E1E4E8">Argument </span><span style="color: #F97583">of</span><span style="color: #E1E4E8"> type </span><span style="color: #9ECBFF">'number'</span><span style="color: #E1E4E8"> is not assignable to parameter </span><span style="color: #F97583">of</span><span style="color: #E1E4E8"> type </span><span style="color: #9ECBFF">'string'</span><span style="color: #E1E4E8">.</span></span>
<span class="line"><span style="color: #E1E4E8">str </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> str.</span><span style="color: #B392F0">toLowerCase</span><span style="color: #E1E4E8">();</span></span></code></pre>
<p>この例の場合、引数の型によって返り値の型が決まるため、上記のような型のエラーに気づくことができます。</p>
<p>このように型の安全性と汎用性を共存させることができます。</p>
<h2 id="わからないこと">わからないこと</h2>
<p>ジェネリクスがここまでの例で解決することを理解はできましたが、オーバーロードやユニオン型でも解決できそうな気がします。</p>
<p>例を再度考えてみます。</p>
<p>ジェネリクスを使うことで型の種類を問わず引数のように使用する側で渡すことができる点では汎用性は高そうです。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">chooseRandomly</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">>(</span><span style="color: #FFAB70">v1</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">, </span><span style="color: #FFAB70">v2</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">)</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> Math.</span><span style="color: #B392F0">random</span><span style="color: #E1E4E8">() </span><span style="color: #F97583">&#x3C;=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">0.5</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">?</span><span style="color: #E1E4E8"> v1 </span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> v2;</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre>
<h3 id="ジェネリクスの型推論">ジェネリクスの型推論</h3>
<p>ジェネリクスを使用すると型推論されます。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">hoge</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">>(</span><span style="color: #FFAB70">x</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">alert</span><span style="color: #E1E4E8">(x </span><span style="color: #F97583">instanceof</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Date</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"><span style="color: #B392F0">hoge</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8">>(</span><span style="color: #9ECBFF">"new Date()"</span><span style="color: #E1E4E8">); </span><span style="color: #6A737D">// false</span></span>
<span class="line"><span style="color: #B392F0">hoge</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">Date</span><span style="color: #E1E4E8">>(</span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Date</span><span style="color: #E1E4E8">()); </span><span style="color: #6A737D">// true</span></span></code></pre>
<p>このように、ジェネリクスを使って型推論を利用することができ、さらに型の指定はコンパイラに推論可能であれば型名を省略できます。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">hoge</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">>(</span><span style="color: #FFAB70">x</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">alert</span><span style="color: #E1E4E8">(x </span><span style="color: #F97583">instanceof</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Date</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"><span style="color: #B392F0">hoge</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">"new Date()"</span><span style="color: #E1E4E8">); </span><span style="color: #6A737D">// false</span></span>
<span class="line"><span style="color: #B392F0">hoge</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Date</span><span style="color: #E1E4E8">()); </span><span style="color: #6A737D">// true</span></span></code></pre>
<h3 id="問題点-型のメソッドを使えない">問題点: 型のメソッドを使えない</h3>
<p>ここまでの説明だと型自体を決定することはできるんですが、実際に渡ってくる引数の型は呼び出されるまで分かりません。<br>
そのために型に属する機能をなにも呼ぶことができない状態になります。<br>
この問題を解決するためにはジェネリクスを下記のように使用します。<br>
そしてこの使い方こそがジェネリクスの真価を発揮する方法だと思っています。</p>
<h3 id="解決策-ジェネリクスの制約">解決策: ジェネリクスの制約</h3>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">interface</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">X</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">sayMyName</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"><span style="color: #E1E4E8"> </span></span>
<span class="line"><span style="color: #F97583">class</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Y</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">implements</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">X</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">public</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">sayMyName</span><span style="color: #E1E4E8">() {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">alert</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">"I'm Big-Boy"</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"><span style="color: #E1E4E8"> </span></span>
<span class="line"><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">a</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">>(</span><span style="color: #FFAB70">t</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">  t.</span><span style="color: #B392F0">sayMyName</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"><span style="color: #E1E4E8"> </span></span>
<span class="line"><span style="color: #B392F0">a</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Y</span><span style="color: #E1E4E8">());</span></span></code></pre>
<p>上記のコードはコンパイルできません。理由は<code>T</code>という型がコンパイル時には未知の型であるためです。<br>
この問題を解決するためには型引数<code>T</code>自体に制約を追加します。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">a</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">T</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">extends</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">X</span><span style="color: #E1E4E8">>(</span><span style="color: #FFAB70">t</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">    t.</span><span style="color: #B392F0">sayMyName</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre>
<p><code>&#x3C;T extends X></code>で型<code>X</code>もしくは<code>X</code>を継承した型のみを型引数にとるということを表現します。</p>
<p>ちなみに、下記のように利用したいメンバーだけを強制することもできます。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">a</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">T</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">extends</span><span style="color: #E1E4E8"> { </span><span style="color: #B392F0">sayMyName</span><span style="color: #E1E4E8">(); }>(</span><span style="color: #FFAB70">t</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">    t.</span><span style="color: #B392F0">sayMyName</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre>
<p>この使い方はTypeScriptのダックタイピング的な動作を利用しています。</p>
<h3 id="ダックタイピング">ダックタイピング</h3>
<p>個人的にこれまで静的型付け言語に触れることが多く、プロダクトで使用しているPHPも現在はほぼC#のような静的型付けに近い運用をしているため<code>ダックタイピング</code>という考え方に馴染みがないのでまとめておきます。</p>
<p>コンパイル時に型の検査をするのではなく、実行時に実行するという方法です。<br>
オブジェクトに何ができるかはクラスではなく実行時のオブジェクトそのものが決定するという考え方です。</p>
<blockquote>
<p>“If it walks like a duck and quacks like a duck, it must be a duck”
（もしもそれがアヒルのように歩き、アヒルのように鳴くのなら、それはアヒルに違いない）</p>
</blockquote>
<p>言い換えれば、<code>同じ振る舞いを持つものは共通のインターフェースを持つ</code>とも言えます。<br>
インターフェースの判定に継承は関係なく、必要なインターフェースを持っているかどうかのみに着目します。</p>
<p>ここ最近Ruby on Railsに触れる機会があるのですが、Rubyのばあいは一般的なクラス継承もできるので継承によるポリモーフィズムも利用できます。が、ダックタイピングを使えば継承が不要であり型による制約に縛られることなく簡素なコードで実現ができます。<br>
ただ、動的型付け言語でダックタイピングは乱用されることがあり、ここ最近では静的型付け言語に注目が集まっているのでメリットとデメリットを理解することが必要です。</p>
<h2 id="まとめ">まとめ</h2>
<ul>
<li>ジェネリクスを使用することで引数の型が決まっていない処理を共通化できる</li>
<li>コレクション等でメリットが大きい</li>
<li>ある程度の型推論にも使えるが過信はできない</li>
<li>振る舞いを利用する場合は型引数自体に<code>extends</code>を使って制限をかける必要がある</li>
</ul>
<h3 id="参考">参考</h3>
<p><a href="https://qiita.com/k-penguin-sato/items/9baa959e8919157afcd4">https://qiita.com/k-penguin-sato/items/9baa959e8919157afcd4</a><br>
<a href="https://typescriptbook.jp/reference/generics">https://typescriptbook.jp/reference/generics</a><br>
<a href="https://www.buildinsider.net/language/tsgeneric/01">https://www.buildinsider.net/language/tsgeneric/01</a><br>
<a href="https://ja.wikipedia.org/wiki/%E3%83%80%E3%83%83%E3%82%AF%E3%83%BB%E3%82%BF%E3%82%A4%E3%83%94%E3%83%B3%E3%82%B0">https://ja.wikipedia.org/wiki/%E3%83%80%E3%83%83%E3%82%AF%E3%83%BB%E3%82%BF%E3%82%A4%E3%83%94%E3%83%B3%E3%82%B0</a></p></div></div><div class="footer"><div class="copyright">©︎ 2023 taisei miyaji</div><div class="icons"><span class="github"><a href="https://github.com/taiseimiyaji" target="_blank"><img src="/github-mark/github-mark-white.png" width="100%" height="100%" alt="github"/></a></span></div></div></main></body></html>