<!DOCTYPE html><html lang="ja"> <head><title>マイグレーションについて</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta name="description" content="

## 参考

https://readouble.com/laravel/8.x/ja/migrations.html#column-method-integer

https://tohokuaiki.hateblo.jp/entry"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZBD90YGZ4N"></script><style>@charset "UTF-8";html{background-color:#23272f;font-size:16px;color:#f6f7f9}.header{color:#f6f7f9;justify-content:space-around;border-bottom:.5px solid}.header-link{display:flex;justify-content:space-around;font-size:1.5rem;padding:.5rem;border-color:#f6f7f9;margin:0 auto;max-width:70rem;width:94vw}.header-link div{color:#f6f7f9}.header .title{border-bottom:.5px solid;text-align:center;font-weight:700;padding:2rem;font-size:2.5rem}.card{box-sizing:border-box;background-color:#23272f;border:1px solid #F6F7F9;border-radius:1rem;display:flex;flex-direction:column;padding:2rem;gap:1rem;color:#f6f7f9}.card .title{font-size:large;overflow:inherit}.card:hover{background-color:#2d3748;color:#fff;box-shadow:0 6px 8px #00000026}.card-list{gap:1rem;flex-direction:column;display:flex}code{font-size:1rem}:root{--accent: 124, 58, 237;--accent-gradient: linear-gradient(45deg, rgb(var(--accent)), #da62c4 30%, white 60%)}html{font-family:system-ui,sans-serif}code{font-family:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace}.content{padding:2rem 0;margin:0 auto;max-width:70rem;width:94vw}.content .post{overflow-wrap:normal;overflow:hidden}.content p,.content ul li,.content ol li{line-height:1.7}a{color:#f6f7f9;text-decoration:none}img{width:100%}*,*:before,*:after{box-sizing:border-box}.card-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(min(250px,100%),1fr));gap:1rem;padding:1rem}.sns-button{display:flex;align-items:center;justify-content:center;background-color:#23272f;border:1px solid white;color:#fff;padding:1rem;border-radius:.5rem;box-shadow:0 4px 6px #0000001a;transition:background-color .3s ease,box-shadow .3s ease;width:100%;max-width:100%;text-align:center;font-size:1.25rem;cursor:pointer;margin:0}.sns-button:hover{background-color:#2d3748;color:#fff;box-shadow:0 6px 8px #00000026}.sns-button svg{stroke:currentColor;fill:currentColor;stroke-width:0;height:1.5em;width:1.5em;margin-right:.5rem}pre.astro-code.github-dark{background-color:#2d333b!important;overflow-x:auto;padding:1rem;border-radius:.2rem}.footer{border-top:1px solid #F6F7F9;padding:1rem;align-items:center;display:flex;max-height:2rem}.footer .copyright{order:1}.footer .icons{margin-left:auto;order:2;width:2rem;height:2rem}
html{background-color:#23272f;font-size:16px;color:#f6f7f9}.header{color:#f6f7f9;justify-content:space-around;border-bottom:.5px solid}.header-link{display:flex;justify-content:space-around;font-size:1.5rem;padding:.5rem;border-color:#f6f7f9;margin:0 auto;max-width:70rem;width:94vw}.header-link div{color:#f6f7f9}.header .title{border-bottom:.5px solid;text-align:center;font-weight:700;padding:2rem;font-size:2.5rem}.footer{border-top:1px solid #F6F7F9;padding:1rem;align-items:center;display:flex;max-height:2rem}.footer .copyright{order:1}.footer .icons{margin-left:auto;order:2;width:2rem;height:2rem}.card{box-sizing:border-box;background-color:#23272f;border:1px solid #F6F7F9;border-radius:1rem;display:flex;flex-direction:column;padding:2rem;gap:1rem;color:#f6f7f9}.card .title{font-size:large;overflow:inherit}.card:hover{background-color:#2d3748;color:#fff;box-shadow:0 6px 8px #00000026}.card-list{gap:1rem;flex-direction:column;display:flex}.content a{text-decoration:underline}.content table{width:100%;border-collapse:collapse;margin:2rem 0}.content table th,.content table td{border:1px solid #F6F7F9;padding:.5rem;text-align:left}.content table th{background-color:#f6f7f933;color:#f6f7f9;font-weight:700}.content table tr:nth-child(odd){background-color:#f6f7f91a}.content table tr:nth-child(2n){background-color:#f6f7f90d}.content blockquote{padding:1rem;margin:1rem 0;border-left:4px solid #F6F7F9;background-color:#f6f7f91a;color:#f6f7f9;font-style:italic;overflow-wrap:break-word}.content blockquote p{margin:0}.content h2{color:#f6f7f9;margin:2rem 0 1rem;font-size:1.5rem;font-weight:700;border-bottom:2px solid #F6F7F9;padding-bottom:.5rem}
</style><script type="module">window.dataLayer=window.dataLayer||[];function a(){dataLayer.push(arguments)}a("js",new Date);a("config","G-ZBD90YGZ4N");
</script></head> <!-- Google tag (gtag.js) -->  <body> <main> <div class="header"><div class="title"><a href="/">Lyricrime.com</a></div><div class="header-link"><a href="/"><div> Blog</div></a><a href="/profile"><div>Profile</div></a></div></div> <div class="content"> <div class="date">2022/05/06</div> <h1>マイグレーションについて</h1> <div class="post"> <h2 id="参考">参考</h2>
<p><a href="https://readouble.com/laravel/8.x/ja/migrations.html#column-method-integer">https://readouble.com/laravel/8.x/ja/migrations.html#column-method-integer</a></p>
<p><a href="https://tohokuaiki.hateblo.jp/entry/2016/12/26/%E3%80%8CLaravel%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9%E3%80%8D3_%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9">https://tohokuaiki.hateblo.jp/entry/2016/12/26/%E3%80%8CLaravel%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9%E3%80%8D3_%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9</a></p>
<p><a href="https://onetech.jp/blog/how-to-migration-in-laravel-11913#:~:text=%E3%83%9E%E3%82%A4%E3%82%B0%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AF%E3%80%81Laravel%E3%82%92%E7%94%A8,%E5%8A%B9%E7%8E%87%E3%82%82%E5%90%91%E4%B8%8A%E3%81%97%E3%81%BE%E3%81%99%E3%80%82">https://onetech.jp/blog/how-to-migration-in-laravel-11913#:~:text=%E3%83%9E%E3%82%A4%E3%82%B0%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AF%E3%80%81Laravel%E3%82%92%E7%94%A8,%E5%8A%B9%E7%8E%87%E3%82%82%E5%90%91%E4%B8%8A%E3%81%97%E3%81%BE%E3%81%99%E3%80%82</a></p>
<h2 id="マイグレーションとは">マイグレーションとは</h2>
<p>Lravel公式には以下の記述があります。</p>
<blockquote>
<p>マイグレーションはデータベースのバージョン管理のようなもので、チームがアプリケーションのデータベーススキーマを定義および共有できるようにします。ソース管理から変更を取得した後に、ローカルデータベーススキーマにカラムを手動で追加するようにチームメートに指示する必要があったことを経験していれば、データベースのマイグレーションにより解決される問題に直面していたのです。</p>
</blockquote>
<p>マイグレーションとは、「移行」を意味します。
テーブル定義を管理するために実行するコマンドです。
テーブルに変更があった際、チームのメンバーのテーブルを簡単にアップデートが行えます。</p>
<h2 id="laravelにおけるマイグレーション">Laravelにおけるマイグレーション</h2>
<h3 id="マイグレーションファイルの作成">マイグレーションファイルの作成</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">php</span><span style="color:#9ECBFF"> artisan</span><span style="color:#9ECBFF"> make:migration</span><span style="color:#9ECBFF"> ファイル名</span></span>
<span class="line"></span></code></pre>
<p>上記コマンドを実行すると、database/migrationsの下にマイグレーションファイルが作成されます。</p>
<p>この時のファイル名には、Laravelがマイグレーションの順序を決定できるようにするタイムスタンプを含めて作成されます。</p>
<p>ただし、この時指定するファイル名が既存のものと被るとClass名として被るため、Fatalになって失敗します。</p>
<p>これを回避するために、<code>create_hogehoge_table</code>みたいな感じで操作名とテーブル名などを含むようにして被ることの無いよう工夫する必要があります。</p>
<h3 id="マイグレーションファイルの編集">マイグレーションファイルの編集</h3>
<p>先述したartisanコマンドでマイグレーションファイルを作成すると、デフォルトで<code>up</code>と<code>down</code>というメソッドが定義されています。</p>
<p><code>up</code>メソッドにはデータベース構造の変更を実施する際に実行される内容を記述します。
<code>down</code>メソッドには<code>up</code>メソッドの操作を元に戻す内容を記述します。</p>
<p>記述後、</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">php</span><span style="color:#9ECBFF"> artisan</span><span style="color:#9ECBFF"> migrate</span></span>
<span class="line"></span></code></pre>
<p>を実行することでマイグレーションが実行されます。</p>
<h3 id="マイグレーションの取り消し">マイグレーションの取り消し</h3>
<p>マイグレーションを行った後、取り消したい場合には以下のコマンドを実行することでロールバックすることができます。</p>
<ul>
<li>最新のマイグレーションを取り消す</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">php</span><span style="color:#9ECBFF"> artisan</span><span style="color:#9ECBFF"> migrate:rollback</span></span>
<span class="line"></span></code></pre>
<ul>
<li>全てのマイグレーションを取り消す</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">php</span><span style="color:#9ECBFF"> artisan</span><span style="color:#9ECBFF"> migrate:reset</span></span>
<span class="line"></span></code></pre>
<p>また、指定した回数分巻き戻す場合は<code>--step</code>オプションで巻き戻したい件数を指定しましょう。</p>
<p>全てのデータベースマイグレーションをロールバックし、それから<code>migrate</code>コマンドを実行したい場合は以下のコマンドで対応できます。データベース全体を作り直すために便利なコマンドです。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">php</span><span style="color:#9ECBFF"> artisan</span><span style="color:#9ECBFF"> migrate:refresh</span></span>
<span class="line"></span></code></pre>
<p>また、<code>--seed</code>オプションを付けることで全データベースシードを実行できます。</p>
<h2 id="まとめというかメモ">まとめというかメモ</h2>
<p>マイグレーションという仕組みを用いることで、チームで開発する際のデータベースの更新の際に生じる問題を解決できます。</p>
<p>詳細な<code>Schema</code>ビルダの使い方は公式ドキュメントに説明を譲るとして、注意しとかないといけないなと感じた箇所をメモしておきます。</p>
<ul>
<li><code>change</code>メソッドは存在するカラムを新しいタイプへ変更するか、カラムの属性を変える際に使用します。</li>
<li><code>$table->timestamps();</code>で<code>created_at</code>と<code>updated_at</code>の二つのカラムが追加されます。</li>
<li>文中でも一度書きましたが、名前被りには気をつける。</li>
<li>migrationはあくまでテーブルの構造なので、中身を作成するのはseederで行う。</li>
</ul>
<h2 id="所感">所感</h2>
<p>Laravelの仕組みを用いることで、チーム開発が捗る部分がとても多いなということを日々実感します。</p>
<p>ただし、Laravelの機能を使用するということはつまり、Laravelに依存するということになります。</p>
<p>クリーンアーキテクチャを意識すると、フレームワークに依存する箇所とそうでない、生のPHPを使用する箇所を分離することになります。
どの部分がLaravelの機能で、どの部分がPHPの機能なのか、しっかり分けられるよう意識しておかないと初学者のうちはごちゃ混ぜになってしまいそうなので気をつけたいと感じました。</p> </div> </div> <div class="footer"><div class="copyright">©︎ 2024 taisei miyaji</div><div class="icons"><span class="github"><a href="https://github.com/taiseimiyaji" target="_blank"><img src="/github-mark/github-mark-white.png" width="100%" height="100%" alt="github"/></a></span></div></div> </main> </body></html>