<!DOCTYPE html><html lang="ja"> <head><title>できる限りドキュメントメンテナンスコストを下げたい [Doxygen] [phpDocumentor]</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta name="description" content="## はじめに(長めの前置き)
大前提として、「コードは必ず変更される」ことはエンジニアであれば理解されていると思います。   
経験上、コードを書いて1回切りの「作り捨て」にすることはまずありません。   
自分が変更するかもしれませんし"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZBD90YGZ4N"></script><style>@charset "UTF-8";html{background-color:#23272f;font-size:16px;color:#f6f7f9}.header{color:#f6f7f9;justify-content:space-around;border-bottom:.5px solid}.header-link{display:flex;justify-content:space-around;font-size:1.5rem;padding:.5rem;border-color:#f6f7f9;margin:0 auto;max-width:70rem;width:94vw}.header-link div{color:#f6f7f9}.header .title{border-bottom:.5px solid;text-align:center;font-weight:700;padding:2rem;font-size:2.5rem}.card{box-sizing:border-box;background-color:#23272f;border:1px solid #F6F7F9;border-radius:1rem;display:flex;flex-direction:column;padding:2rem;gap:1rem;color:#f6f7f9}.card .title{font-size:large;overflow:inherit}.card:hover{background-color:#2d3748;color:#fff;box-shadow:0 6px 8px #00000026}.card-list{gap:1rem;flex-direction:column;display:flex}code{font-size:1rem}:root{--accent: 124, 58, 237;--accent-gradient: linear-gradient(45deg, rgb(var(--accent)), #da62c4 30%, white 60%)}html{font-family:system-ui,sans-serif}code{font-family:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace}.content{padding:2rem 0;margin:0 auto;max-width:70rem;width:94vw}.content .post{overflow-wrap:normal;overflow:hidden}.content p,.content ul li,.content ol li{line-height:1.7}a{color:#f6f7f9;text-decoration:none}img{width:100%}*,*:before,*:after{box-sizing:border-box}.card-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(min(250px,100%),1fr));gap:1rem;padding:1rem}.sns-button{display:flex;align-items:center;justify-content:center;background-color:#23272f;border:1px solid white;color:#fff;padding:1rem;border-radius:.5rem;box-shadow:0 4px 6px #0000001a;transition:background-color .3s ease,box-shadow .3s ease;width:100%;max-width:100%;text-align:center;font-size:1.25rem;cursor:pointer;margin:0}.sns-button:hover{background-color:#2d3748;color:#fff;box-shadow:0 6px 8px #00000026}.sns-button svg{stroke:currentColor;fill:currentColor;stroke-width:0;height:1.5em;width:1.5em;margin-right:.5rem}pre.astro-code.github-dark{background-color:#2d333b!important;overflow-x:auto;padding:1rem;border-radius:.2rem}.footer{border-top:1px solid #F6F7F9;padding:1rem;align-items:center;display:flex;max-height:2rem}.footer .copyright{order:1}.footer .icons{margin-left:auto;order:2;width:2rem;height:2rem}
html{background-color:#23272f;font-size:16px;color:#f6f7f9}.header{color:#f6f7f9;justify-content:space-around;border-bottom:.5px solid}.header-link{display:flex;justify-content:space-around;font-size:1.5rem;padding:.5rem;border-color:#f6f7f9;margin:0 auto;max-width:70rem;width:94vw}.header-link div{color:#f6f7f9}.header .title{border-bottom:.5px solid;text-align:center;font-weight:700;padding:2rem;font-size:2.5rem}.footer{border-top:1px solid #F6F7F9;padding:1rem;align-items:center;display:flex;max-height:2rem}.footer .copyright{order:1}.footer .icons{margin-left:auto;order:2;width:2rem;height:2rem}.card{box-sizing:border-box;background-color:#23272f;border:1px solid #F6F7F9;border-radius:1rem;display:flex;flex-direction:column;padding:2rem;gap:1rem;color:#f6f7f9}.card .title{font-size:large;overflow:inherit}.card:hover{background-color:#2d3748;color:#fff;box-shadow:0 6px 8px #00000026}.card-list{gap:1rem;flex-direction:column;display:flex}.content a{text-decoration:underline}.content table{width:100%;border-collapse:collapse;margin:2rem 0}.content table th,.content table td{border:1px solid #F6F7F9;padding:.5rem;text-align:left}.content table th{background-color:#f6f7f933;color:#f6f7f9;font-weight:700}.content table tr:nth-child(odd){background-color:#f6f7f91a}.content table tr:nth-child(2n){background-color:#f6f7f90d}.content blockquote{padding:1rem;margin:1rem 0;border-left:4px solid #F6F7F9;background-color:#f6f7f91a;color:#f6f7f9;font-style:italic;overflow-wrap:break-word}.content blockquote p{margin:0}.content h2{color:#f6f7f9;margin:2rem 0 1rem;font-size:1.5rem;font-weight:700;border-bottom:2px solid #F6F7F9;padding-bottom:.5rem}
</style></head> <!-- Google tag (gtag.js) --> <script type="module">window.dataLayer=window.dataLayer||[];function a(){dataLayer.push(arguments)}a("js",new Date);a("config","G-ZBD90YGZ4N");</script> <body> <main> <div class="header"><div class="title"><a href="/">Lyricrime.com</a></div><div class="header-link"><a href="/"><div> Blog</div></a><a href="/profile"><div>Profile</div></a></div></div> <div class="content"> <div class="date">2022/05/13</div> <h1>できる限りドキュメントメンテナンスコストを下げたい [Doxygen] [phpDocumentor]</h1> <div class="post"> <h2 id="はじめに長めの前置き">はじめに(長めの前置き)</h2>
<p>大前提として、「コードは必ず変更される」ことはエンジニアであれば理解されていると思います。<br>
経験上、コードを書いて1回切りの「作り捨て」にすることはまずありません。<br>
自分が変更するかもしれませんし、他人が変更することもあるでしょう。<br>
よく「三日後の自分は他人」とも言いますが、そう考えるとほとんどの場合、書いたコードを変更するのは「他人」ということになります。<br>
コードを書く際の判断や選択はこの前提を忘れないようにしましょう。</p>
<p>ソフトウェアというのは複雑なものです。
完璧なソフトウェアというのは存在せず、障害が発生したり、ユーザーからの要望を反映しなければならないことがあります。</p>
<p>コードを理解するとき、その助けとなるのが各種設計書です。<br>
ただ、設計書は往々にして腐ります。<br>
コードはさまざまな要因で変更されますが、それに合わせて設計書を変更するのが手間だからです。</p>
<p>そこで、できるだけ楽をしてドキュメントを作成できれば、設計書のメンテナンスコストを下げることにつながると考え、ツールを使用してアプローチしてみたいと思います。</p>
<p>本記事では、PHPを使用したチーム開発環境を前提として、Doxygenとphpdocumentorを導入してみてその違いを触って理解してみます。</p>
<p>本記事は書いてある通りに実行すれば導入できるような親切な記事ではなく、実際に導入してみたいなと考えた時に必要な情報のみを記載します。</p>
<p>特にサンプルについてはあまり見当たらなかったのでよければ参考にしてください。
詳しい設定等は公式ドキュメントなどを参照してください。</p>
<h2 id="doxygenのインストール">Doxygenのインストール</h2>
<h2 id="参考">参考</h2>
<p><a href="https://qiita.com/hyt-sasaki/items/8f8312e277d1a4815ab6">https://qiita.com/hyt-sasaki/items/8f8312e277d1a4815ab6</a></p>
<h2 id="doxygenとは">Doxygenとは</h2>
<p>簡単にいうと、コードに記載されたコメントをもとに、設計書やクラス関係図などのドキュメントを生成してくれるツールです。</p>
<p>公式リンク <a href="http://www.doxygen.jp/">http://www.doxygen.jp/</a></p>
<p>今回はDockerを用いたチーム開発を前提として環境構築してみます。</p>
<p>Docker Hubから<code>hytssk/doxygen</code>というイメージをpullしてきます。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>docker pull hytssk/doxygen</span></span></code></pre>
<h3 id="doxyfileの作成">Doxyfileの作成</h3>
<p>Doxygenは<code>Doxyfile</code>という設定ファイルを使用します。
下記コマンドを実行して生成します。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>docker run --rm -v "${PWD}":/src hytssk/doxygen -g</span></span></code></pre>
<p>内容の編集については公式ドキュメントを参照してください。(コメントを読むだけでもある程度わかります。)</p>
<p>参考サイト:</p>
<p><a href="http://www.doxygen.jp/config.html">http://www.doxygen.jp/config.html</a></p>
<p><a href="https://cercopes-z.com/Doxygen/list-config-dxy.html">https://cercopes-z.com/Doxygen/list-config-dxy.html</a></p>
<h3 id="動作確認用変更箇所">動作確認用変更箇所</h3>
<p>僕が動作確認した際に変更した箇所をメモしておきます。
もっと変えた方がいい箇所があるかもしれないです。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>OUTPUT_LANGUAGE = Japanese</span></span>
<span class="line"><span>EXTRACT_ALL            = YES</span></span>
<span class="line"><span>WARN_LOGFILE           = "ログファイル名.txt"</span></span>
<span class="line"><span>INPUT                  = ソースコードのパス</span></span>
<span class="line"><span>RECURSIVE              = YES</span></span>
<span class="line"><span>SOURCE_BROWSER         = YES</span></span>
<span class="line"><span>GENERATE_LATEX         = NO</span></span>
<span class="line"><span>CALL_GRAPH             = YES</span></span>
<span class="line"><span>CALLER_GRAPH           = YES</span></span></code></pre>
<h3 id="ドキュメント化">ドキュメント化</h3>
<p>ソースコードにDoxygen用のコメントを記載した上で使用します。
以下コマンドを実行することでドキュメントが生成されます。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>docker run --rm -v "${PWD}":/src hytssk/doxygen Doxyfile</span></span></code></pre>
<h2 id="phpdocumentor">phpDocumentor</h2>
<h3 id="phpdocumentorとは">phpDocumentorとは</h3>
<p>Doxygenと同じくソースコードからドキュメントを生成するツールです。</p>
<p>公式Github</p>
<p><a href="https://github.com/phpDocumentor/phpDocumentor">https://github.com/phpDocumentor/phpDocumentor</a></p>
<p>Dockerイメージ</p>
<p><a href="https://hub.docker.com/r/phpdoc/phpdoc/">https://hub.docker.com/r/phpdoc/phpdoc/</a></p>
<h3 id="参考サイト">参考サイト</h3>
<p><a href="https://wand-ta.hatenablog.com/entry/2019/05/18/233631">https://wand-ta.hatenablog.com/entry/2019/05/18/233631</a></p>
<p><a href="http://blog.livedoor.jp/haruchaco/archives/1340012.html">http://blog.livedoor.jp/haruchaco/archives/1340012.html</a></p>
<h3 id="実行">実行</h3>
<p>まずはDoxygenの時と同じくDocker hubからpullします。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>docker pull phpdoc/phpdoc</span></span></code></pre>
<p>ドキュメント生成</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>docker run --rm -v $(pwd):/data phpdoc/phpdoc -d [ソースコードのディレクトリ] -t [出力先のディレクトリ] </span></span></code></pre>
<p>以下のオプションを使用することでクラス図などの図が出力されます。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>--setting=graphs.enabled=true</span></span></code></pre>
<p>以下のオプションを使用すると出力形式を変更できます。
他にも種類があるようなので公式を参照してください。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>--template="clean"</span></span></code></pre>
<h2 id="比較">比較</h2>
<h3 id="インストールの容易さ">インストールの容易さ</h3>
<p>phpdocumentorの方がインストールが簡単だという意見を見かけました。<br>
->まあ今回のようにDocker使うなら大して差はないです。</p>
<h3 id="出力の違い">出力の違い</h3>
<p>個人的にはphpDocumentorの方が新しいツールなのもあって出力結果のUIがいい感じだと思う。
DoxygenはPHPへの対応が少し弱いのでこの部分でphpDocumentorを選択するのはアリだと思います。
(ちなみにC言語とJavaでDoxygenを使用したことがあるがその時はいい感じだった。)</p>
<h2 id="サンプル">サンプル</h2>
<p>個人的に作ってるコードをドキュメント化してみました。<br>
簡単なValueObjectのみ作成しているが、Interface,abstractなどを使用してクラス図を確認できるようにしています。<br>
コメントにツール用の記述をすることでさらにドキュメントを充実させることができます。(というかそれが本来の使い方)<br>
ひとまず図を見たい人のためのサンプルだと思ってください。<br>
またサンプルコードが充実したら追記しようかな。</p>
<p>Doxygenのサンプル<br>
<a href="https://taiseimiyaji.github.io/doxygen_sample/">https://taiseimiyaji.github.io/doxygen_sample/</a></p>
<p>phpDocumentorのサンプル<br>
<a href="https://taiseimiyaji.github.io/phpDocumentor_sample/">https://taiseimiyaji.github.io/phpDocumentor_sample/</a></p>
<h2 id="所感">所感</h2>
<p>ドキュメントのメンテナンスはコストがかかるしめんどくさいものです。<br>
特に規模が小さい場合、わざわざドキュメントを作ることに後ろ向きになりがちだと思います。<br>
今回紹介したツールを使用すればさほど手間なくドキュメントを作成することができます。</p>
<p>チーム開発の場合は個人の力量に差があることが多く、その差を埋める手助けになればと思います。<br>
また、上級者から初学者への説明の際の資料としても有用だと思いました。</p>
<p>個人的にはこういうめんどくさいなあと感じたことを自動化する瞬間が一番エンジニアであることを実感します。</p> </div> </div> <div class="footer"><div class="copyright">©︎ 2024 taisei miyaji</div><div class="icons"><span class="github"><a href="https://github.com/taiseimiyaji" target="_blank"><img src="/github-mark/github-mark-white.png" width="100%" height="100%" alt="github"/></a></span></div></div> </main> </body></html>